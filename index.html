<!doctype html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
        integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
        integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
        crossorigin=""></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #map {
            z-index: -1;
            position: absolute;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div style="position: absolute;bottom: 1rem;">
        <div class="box">
            <article class="media">
                <div class="media-content">
                    <div class="content" id="player_onlinelist">
                    </div>
                </div>
            </article>
        </div>
        <div class="box">
            <article class="media">
                <div class="media-content">
                    <div class="content" id="mouse_coordinate">
                        <p>0,0</p>
                    </div>
                </div>
            </article>
        </div>
    </div>
    <script>
        var mymap = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://api.mapbox.com/styles/v1/earthmcbe/ck24s7poc0imv1dqwv9fev3ap/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZWFydGhtY2JlIiwiYSI6ImNrMThoZHIxZzFxYzAzbnRqZmFsd3Q2azIifQ.3bQMOqJyHZ9C-8IhpAT4Ow', {
            attribution: 'OpenStreetMap'
        }).addTo(mymap);
    </script>
    <script>
        var json_request = new XMLHttpRequest();
        json_request.open("POST", "https://api-server.earthmcbe.space/api/User/GetOnlineList2");
        json_request.send();
        json_request.onreadystatechange = function (ready) {
            if (json_request.readyState == 4 && json_request.status == 200) {
                var onlinelist_get_json = json_request.responseText;
                var onlinelist_array = JSON.parse(onlinelist_get_json);
                onlinelist_array = onlinelist_array.returnObject;
                for (i = 0; i < onlinelist_array.length; i++) {
                    var name = onlinelist_array[i].name;
                    var longitude = onlinelist_array[i].position.x;
                    longitude = longitude / (120);
                    var latitude = onlinelist_array[i].position.z;
                    latitude = latitude / (-120);
                    var marker = L.marker([latitude, longitude]).addTo(mymap);
                    marker.bindTooltip(name).openTooltip();
                    document.getElementById('player_onlinelist').innerHTML += '<p id="' + name + "," + latitude + "," + longitude + '" onclick="highlight(this.id)">' + name + '</p>';
                }
            }
            mymap.on('mousemove', function (coordinate) {
                document.getElementById('mouse_coordinate').innerHTML = (coordinate.latlng.lat * 120).toFixed(0) + "," + (coordinate.latlng.lng * 120).toFixed(0)
            });
            function highlight(id) {
                var latlng = id.split(",");
                console.log(latlng)
            }
        };
    </script>
</body>

</html>